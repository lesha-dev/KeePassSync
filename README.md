# KeePassSync
Параноидальный скрипт для синхронизации паролей KeePass с дропбоксом.

Работает только под Windows, требует Python 3.

Также скрипт проверяет версию KeePass и обновляет, если она устарела.

## Параметры
`-t/--token` - токен для авторизации в дропбоксе

`-f/--folder` - папка, где находится KeepAss. По умолчанию: текущая папка.

`-kdb/--kdb-path` - путь до файла с паролями. По умолчанию: Database.kdbx

`-df/--dropbox-folder` - имя папки в дропбоксе, куда закачается файл с паролями. По умолчанию: корневая папка

`-r/--remove-local-kdb` - удалять ли локальный файл с паролями после синхронизации. По умолчанию: не удалять

## Примеры
```
Запустить скрипт из папки с KeePass 2.x и синхронизировать файл паролей Database.kdbx:
python KeePassSync.py -t "xxxxxxxxx"

Запустить скрипт из папки с KeePass 1.x:
python KeePassSync.py -t "xxxxxxxxx" -kdb Database.kdb

Запустить скрипт для всего в разных папках и удалить файл паролей после синхронизации:
python KeePassSync.py -t "xxxxxxxxx" -f d:\bin\KeePass2 -kdb d:\data\Passwords.kdbx -r
```

# Подробный мануал по настройке
## 1. Настройка питона
* Если у тебя нет Python 3, то установи его: https://www.python.org/ftp/python/3.8.5/python-3.8.5-amd64.exe
* Создай папку для кипаса, например c:\KeePass
* Запусти консоль из папки кипаса, из консоли выполни:
```
python -m virtualenv .venv
.venv\Scripts\python -m pip install -r required.txt
```
* В паке с кипасом создай текстовый файл KeePass.bat, напиши туда:
```
CALL .venv\Scripts\python KeePassSync.py -t ""
```
* Скачай архив со скриптом (на этой странице кнопка Code -> Download zip)
* Распакуй архив в папку кипаса

## 2. Настройка дропбокса
* Залогинься в дропбокс
* Заходи на эту страницу: https://www.dropbox.com/developers, нажимай кнопку `Создать приложения`
* Выбери настройки:
> 1. Choose an API: Scoped access
> 2. Choose the type of access you need: App folder
> 3. Name your app: KeePassScript
* Нажми кнопку CreateApp. Откроется страница с настройками приложения.
* Иди на вкладку Permissions. Нажимай галочки files.content.read и files.content.write. Жми кнопку Submit
* Иди на вкладку Settings.
* Ищи поле OAuth 2.
* Выбери Access token expiration -> No expiration
* Нажми Generated access token
* Сгенерируется длинный-длинный текст с токеном для доступа. Скопируй его.
* Вставь текст в файл KeePass.bat в пустые кавычки
База данных будет закачиваться в папку на твоем дропбоксе: Приложения/KeePassScript

## 3. Настройка приложения
* Запусти KeePass.bat
* Скачается последний кипас в текущую папку
* Он сразу попросит включить проверку обновлений - откажи ему (вообще без разницы, так как скрипт сам будет обновлять приложение)
* Создай базу данных паролей. Придумай пароль для нее и запомни. Это единственный пароль, который нужно запоминать.
* Нажми меню File->Database Settings, вкладка Security. Там нажми кнопку 1 second delay. Ок.
* Сохрани базу с именем Database в папку кипаса. Например: c:\KeePass\Database.kdbx
* Закрой KeePass
После этого скрипт закачает базу паролей на дропбокс.

Теперь запускай Кипасс всегда не exe, а скрипт KeePass.bat. Он будет обновлять приложение, а также синхронизировать базу данных паролей с дропбоксом. Можно пользоваться на работе и дома: добавил пароль к сайту на работе, дома через скрипт подкачается свежая база данных из дропбокса.

## 4. Настройка на другом компе
* Нужно только выполнить раздел 1 настройки скрипта и скопировать в папку батник с токеном из дропбокса. Скрипт скачает свежую версию KeePass с сайта программы и базу с паролями с твоего дропбокса.
